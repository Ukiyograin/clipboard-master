<Window
    x:Class="ClipboardMaster.UI.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:ClipboardMaster.UI.Controls"
    xmlns:converters="using:ClipboardMaster.UI.Converters"
    xmlns:models="using:ClipboardMaster.UI.Models"
    mc:Ignorable="d"
    Title="Clipboard Master"
    Width="900"
    Height="650"
    MinWidth="600"
    MinHeight="400"
    ExtendsContentIntoTitleBar="True"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    
    <Window.Resources>
        <converters:DateTimeToRelativeConverter x:Key="DateTimeToRelativeConverter"/>
        <converters:ContentTypeToIconConverter x:Key="ContentTypeToIconConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        
        <DataTemplate x:Key="ClipboardItemTemplate" x:DataType="models:ClipboardItemViewModel">
            <Grid Height="80" Padding="12" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 左侧：图标和类型 -->
                <Grid Grid.Column="0" Width="48" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border Width="40" Height="40" 
                            Background="{ThemeResource SystemAccentColorLight2}" 
                            CornerRadius="8">
                        <FontIcon Glyph="{x:Bind Icon, Mode=OneWay}" 
                                  FontSize="16" 
                                  Foreground="{ThemeResource SystemAccentColor}"/>
                    </Border>
                    <TextBlock Text="{x:Bind ContentTypeDisplay, Mode=OneWay}" 
                               FontSize="10" 
                               HorizontalAlignment="Center" 
                               Margin="0,48,0,0"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Grid>
                
                <!-- 中间：内容和信息 -->
                <Grid Grid.Column="1" Margin="12,0" VerticalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 预览内容 -->
                    <TextBlock Grid.Row="0" 
                               Text="{x:Bind PreviewText, Mode=OneWay}" 
                               TextWrapping="Wrap"
                               MaxLines="2"
                               TextTrimming="CharacterEllipsis"
                               FontSize="14"
                               FontWeight="SemiBold"/>
                    
                    <!-- 源应用和时间 -->
                    <TextBlock Grid.Row="1" 
                               Text="{x:Bind SourceInfo, Mode=OneWay}"
                               FontSize="11"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,4,0,0"/>
                    
                    <!-- 标签 -->
                    <ItemsControl Grid.Row="2" 
                                  ItemsSource="{x:Bind Tags, Mode=OneWay}"
                                  Margin="0,4,0,0"
                                  HorizontalAlignment="Left">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Border Style="{StaticResource TagStyle}">
                                    <TextBlock Text="{x:Bind}" 
                                               FontSize="11"
                                               Foreground="{ThemeResource SystemAccentColor}"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
                
                <!-- 右侧：操作按钮 -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            Spacing="4"
                            VerticalAlignment="Center">
                    
                    <!-- 收藏按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" 
                            Click="OnFavoriteClick"
                            Tag="{x:Bind}">
                        <FontIcon Glyph="{x:Bind FavoriteIcon, Mode=OneWay}" 
                                  FontSize="14"/>
                        <Button.ToolTipService.ToolTip>
                            <ToolTip Content="{x:Bind FavoriteTooltip, Mode=OneWay}"/>
                        </Button.ToolTipService.ToolTip>
                    </Button>
                    
                    <!-- 固定按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" 
                            Click="OnPinClick"
                            Tag="{x:Bind}">
                        <FontIcon Glyph="{x:Bind PinnedIcon, Mode=OneWay}" 
                                  FontSize="14"/>
                        <Button.ToolTipService.ToolTip>
                            <ToolTip Content="{x:Bind PinnedTooltip, Mode=OneWay}"/>
                        </Button.ToolTipService.ToolTip>
                    </Button>
                    
                    <!-- 复制按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" 
                            Click="OnCopyClick"
                            Tag="{x:Bind}">
                        <FontIcon Glyph="&#xE8C8;" 
                                  FontSize="14"/>
                        <Button.ToolTipService.ToolTip>
                            <ToolTip Content="复制到剪贴板"/>
                        </Button.ToolTipService.ToolTip>
                    </Button>
                </StackPanel>
                
                <!-- 悬停效果 -->
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal"/>
                        <VisualState x:Name="PointerOver">
                            <VisualState.Setters>
                                <Setter Target="ItemBackground.Opacity" Value="0.1"/>
                            </VisualState.Setters>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <VisualState.Setters>
                                <Setter Target="ItemBackground.Opacity" Value="0.2"/>
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                
                <!-- 背景矩形（用于悬停效果） -->
                <Rectangle x:Name="ItemBackground" 
                           Fill="{ThemeResource SystemAccentColor}" 
                           Opacity="0" 
                           IsHitTestVisible="False"
                           RadiusX="8" RadiusY="8"/>
            </Grid>
        </DataTemplate>
        
        <DataTemplate x:Key="ImageItemTemplate" x:DataType="models:ClipboardItemViewModel">
            <Grid Height="120" Padding="12" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 图片预览 -->
                <Border Grid.Column="0" 
                        Width="96" 
                        Height="96" 
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8">
                    <Image Source="{x:Bind ThumbnailSource, Mode=OneWay}" 
                           Stretch="Uniform"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                </Border>
                
                <!-- 图片信息 -->
                <StackPanel Grid.Column="1" 
                            Margin="12,0" 
                            VerticalAlignment="Center">
                    <TextBlock Text="图片" 
                               FontSize="12"
                               Foreground="{ThemeResource SystemAccentColor}"/>
                    <TextBlock Text="{x:Bind ImageInfo, Mode=OneWay}" 
                               FontSize="11"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,4,0,0"/>
                    <TextBlock Text="{x:Bind SourceInfo, Mode=OneWay}" 
                               FontSize="11"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,0"/>
                </StackPanel>
                
                <!-- 操作按钮 -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            Spacing="4"
                            VerticalAlignment="Center">
                    <Button Style="{StaticResource IconButtonStyle}" 
                            Click="OnFavoriteClick"
                            Tag="{x:Bind}">
                        <FontIcon Glyph="{x:Bind FavoriteIcon, Mode=OneWay}" 
                                  FontSize="14"/>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}" 
                            Click="OnCopyClick"
                            Tag="{x:Bind}">
                        <FontIcon Glyph="&#xE8C8;" 
                                  FontSize="14"/>
                    </Button>
                </StackPanel>
            </Grid>
        </DataTemplate>
        
        <Style TargetType="ListViewItem" BasedOn="{StaticResource ClipboardItemStyle}">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <ListViewItemPresenter
                            ContentTransitions="{TemplateBinding ContentTransitions}"
                            ContentTemplate="{TemplateBinding ContentTemplate}"
                            ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                            CheckBoxBrush="{ThemeResource ListViewItemCheckBoxBrush}"
                            CheckBrush="{ThemeResource ListViewItemCheckBrush}"
                            DragBackground="{ThemeResource ListViewItemDragBackground}"
                            DragForeground="{ThemeResource ListViewItemDragForeground}"
                            FocusBorderBrush="{ThemeResource ListViewItemFocusBorderBrush}"
                            FocusSecondaryBorderBrush="{ThemeResource ListViewItemFocusSecondaryBorderBrush}"
                            PlaceholderBackground="{ThemeResource ListViewItemPlaceholderBackground}"
                            PointerOverBackground="{ThemeResource ListViewItemBackgroundPointerOver}"
                            PointerOverForeground="{ThemeResource ListViewItemForegroundPointerOver}"
                            SelectedBackground="{ThemeResource ListViewItemBackgroundSelected}"
                            SelectedForeground="{ThemeResource ListViewItemForegroundSelected}"
                            SelectedPointerOverBackground="{ThemeResource ListViewItemBackgroundSelectedPointerOver}"
                            PressedBackground="{ThemeResource ListViewItemBackgroundPressed}"
                            SelectedPressedBackground="{ThemeResource ListViewItemBackgroundSelectedPressed}"
                            DisabledOpacity="{ThemeResource ListViewItemDisabledThemeOpacity}"
                            DragOpacity="{ThemeResource ListViewItemDragThemeOpacity}"
                            ReorderHintOffset="{ThemeResource ListViewItemReorderHintThemeOffset}"
                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                            ContentMargin="{TemplateBinding Padding}"
                            CheckMode="Inline"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- 标题栏自定义 -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 自定义标题栏 -->
        <Grid x:Name="AppTitleBar" 
              Grid.Row="0" 
              Height="48"
              Background="{ThemeResource SolidBackgroundFillColorBaseBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- 应用图标和标题 -->
            <StackPanel Grid.Column="0" 
                        Orientation="Horizontal" 
                        Margin="12,0"
                        VerticalAlignment="Center">
                <FontIcon Glyph="&#xE8C8;" 
                          FontSize="16"
                          Margin="0,0,8,0"/>
                <TextBlock Text="Clipboard Master" 
                           FontSize="14"
                           FontWeight="SemiBold"/>
            </StackPanel>
            
            <!-- 搜索框 -->
            <AutoSuggestBox Grid.Column="1" 
                            PlaceholderText="搜索剪贴板历史记录..."
                            QueryIcon="Find"
                            Width="300"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            TextChanged="OnSearchTextChanged"
                            QuerySubmitted="OnSearchSubmitted"/>
            
            <!-- 窗口控制按钮 -->
            <StackPanel Grid.Column="2" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right">
                <Button Style="{StaticResource IconButtonStyle}" 
                        Click="OnSettingsClick">
                    <FontIcon Glyph="&#xE713;" FontSize="14"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" 
                        Click="OnStatisticsClick">
                    <FontIcon Glyph="&#xE9CE;" FontSize="14"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" 
                        Click="OnMinimizeClick">
                    <FontIcon Glyph="&#xE921;" FontSize="14"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" 
                        Click="OnCloseClick">
                    <FontIcon Glyph="&#xE8BB;" FontSize="14"/>
                </Button>
            </StackPanel>
        </Grid>
        
        <!-- 主内容区域 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- 左侧导航 -->
            <Border Grid.Column="0" 
                    Width="200"
                    Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="0,0,1,0">
                <StackPanel Spacing="8" Padding="12">
                    <RadioButton GroupName="NavGroup" 
                                 Content="全部项目" 
                                 IsChecked="True"
                                 Checked="OnNavAllChecked"
                                 Style="{StaticResource NavRadioButtonStyle}"/>
                    <RadioButton GroupName="NavGroup" 
                                 Content="收藏项目" 
                                 Checked="OnNavFavoritesChecked"
                                 Style="{StaticResource NavRadioButtonStyle}"/>
                    <RadioButton GroupName="NavGroup" 
                                 Content="固定项目" 
                                 Checked="OnNavPinnedChecked"
                                 Style="{StaticResource NavRadioButtonStyle}"/>
                    <RadioButton GroupName="NavGroup" 
                                 Content="图片" 
                                 Checked="OnNavImagesChecked"
                                 Style="{StaticResource NavRadioButtonStyle}"/>
                    <RadioButton GroupName="NavGroup" 
                                 Content="文件" 
                                 Checked="OnNavFilesChecked"
                                 Style="{StaticResource NavRadioButtonStyle}"/>
                    
                    <Separator Margin="0,12"/>
                    
                    <Button Content="清理旧项目" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnCleanupClick"/>
                    <Button Content="导出数据" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnExportClick"/>
                    <Button Content="导入数据" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnImportClick"/>
                    
                    <Separator Margin="0,12"/>
                    
                    <StackPanel>
                        <TextBlock Text="统计信息" 
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Margin="0,0,0,4"/>
                        <TextBlock x:Name="StatsText" 
                                   FontSize="11"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- 右侧内容 -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 工具栏 -->
                <StackPanel Grid.Row="0" 
                            Orientation="Horizontal" 
                            Spacing="8"
                            Padding="12"
                            Background="{ThemeResource SolidBackgroundFillColorTertiaryBrush}">
                    <Button Content="复制选中" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnCopySelectedClick"
                            IsEnabled="{x:Bind ViewModel.HasSelectedItem, Mode=OneWay}"/>
                    <Button Content="删除选中" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnDeleteSelectedClick"
                            IsEnabled="{x:Bind ViewModel.HasSelectedItem, Mode=OneWay}"/>
                    <Button Content="添加标签" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnAddTagsClick"
                            IsEnabled="{x:Bind ViewModel.HasSelectedItem, Mode=OneWay}"/>
                    <Button Content="刷新" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="OnRefreshClick"/>
                    
                    <ComboBox Width="120" 
                              SelectedIndex="0"
                              SelectionChanged="OnSortChanged">
                        <ComboBoxItem Content="按时间排序"/>
                        <ComboBoxItem Content="按名称排序"/>
                        <ComboBoxItem Content="按类型排序"/>
                    </ComboBox>
                    
                    <ToggleButton x:Name="AutoRefreshToggle" 
                                  Content="自动刷新"
                                  IsChecked="True"
                                  Checked="OnAutoRefreshChecked"
                                  Unchecked="OnAutoRefreshUnchecked"/>
                </StackPanel>
                
                <!-- 项目列表 -->
                <ListView Grid.Row="1" 
                         x:Name="ItemsListView"
                         ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
                         ItemTemplateSelector="{StaticResource ItemTemplateSelector}"
                         SelectionMode="Single"
                         SelectionChanged="OnItemSelectionChanged"
                         IsItemClickEnabled="True"
                         ItemClick="OnItemClick"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem" BasedOn="{StaticResource ClipboardItemStyle}">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
                
                <!-- 状态栏 -->
                <Border Grid.Row="2" 
                        Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                   Text="{x:Bind ViewModel.StatusText, Mode=OneWay}"
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Margin="12,8"/>
                        
                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal" 
                                    Spacing="12"
                                    Margin="12,8">
                            <TextBlock Text="{x:Bind ViewModel.TotalCountText, Mode=OneWay}"
                                       FontSize="12"/>
                            <TextBlock Text="{x:Bind ViewModel.SelectedCountText, Mode=OneWay}"
                                       FontSize="12"/>
                            <TextBlock Text="{x:Bind ViewModel.MemoryUsageText, Mode=OneWay}"
                                       FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
        
        <!-- 详情面板（悬浮） -->
        <controls:DetailPanel x:Name="DetailPanel" 
                             Visibility="Collapsed"
                             Item="{x:Bind ViewModel.SelectedItem, Mode=OneWay}"
                             Closed="OnDetailPanelClosed"/>
        
        <!-- 加载遮罩 -->
        <Grid x:Name="LoadingOverlay" 
              Background="#80000000"
              Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock Text="正在加载..." 
                           Margin="0,12,0,0"
                           Foreground="White"
                           FontSize="16"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>